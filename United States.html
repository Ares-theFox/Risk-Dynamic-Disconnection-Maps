<!DOCTYPE html>
<html>
  <head>
    <title>Hover over SVG</title>
    <style>
      #map,
      #range {
        position: absolute;
      }
      #range {
        z-index: 1;
      }
      header {
        font-size: 30px;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <header>United States</header>
    <img
      id="map"
      src="https://raw.githubusercontent.com/Ares-theFox/Risk-Dynamic-Disconnection-Maps/main/United%20States.png"
      alt="Map of United States"
    />
    <div id="range"></div>

    <!-- Add a script tag to load the Papa Parse library -->
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5"></script>

    <script>
      var xhr = new XMLHttpRequest();
      xhr.open(
        "GET",
        "https://raw.githubusercontent.com/Ares-theFox/Risk-Dynamic-Disconnection-Maps/main/United%20States%20Paths.svg"
      );
      xhr.onload = function () {
        if (xhr.status === 200) {
          var svg = xhr.responseText;
          var rangeElement = document.getElementById("range");
          rangeElement.innerHTML = svg;
          var svgElement = rangeElement.querySelector("svg");
          var paths = svgElement.querySelectorAll("path");
          var clickCounter = 0; // Add a counter variable to keep track of the number of clicks
          var clickCounterMax = 3; // Specify max blizzards
          paths.forEach(function (path) {
            path.setAttribute("fill", "transparent");
            path.setAttribute("stroke-opacity", "0");
            var mouseoverHandler = function () {
              if (clickCounter < clickCounterMax) {
                this.style.fill = "white";
              }
            };
            var mouseoutHandler = function () {
              this.style.fill = "transparent";
            };
            path.addEventListener("mouseover", mouseoverHandler);
            path.addEventListener("mouseout", mouseoutHandler);
            path.addEventListener("click", function () {
              // Check if clickCounter is less than Max
              if (clickCounter < clickCounterMax) {
                // Create a clipPath element and set its id
                var clipPath = document.createElementNS(
                  "http://www.w3.org/2000/svg",
                  "clipPath"
                );
                clipPath.setAttribute("id", "clip-" + this.id);

                // Clone the clicked path and append it to the clipPath
                var clonedPath = this.cloneNode(true);
                clipPath.appendChild(clonedPath);

                // Append the clipPath to the defs element
                var defs =
                  svgElement.querySelector("defs") ||
                  svgElement.insertBefore(
                    document.createElementNS(
                      "http://www.w3.org/2000/svg",
                      "defs"
                    ),
                    svgElement.firstChild
                  );
                defs.appendChild(clipPath);

                // Create an image element and set its attributes
                var image = document.createElementNS(
                  "http://www.w3.org/2000/svg",
                  "image"
                );
                image.setAttributeNS(
                  "http://www.w3.org/1999/xlink",
                  "href",
                  ""https://raw.githubusercontent.com/Ares-theFox/Risk-Dynamic-Disconnection-Maps/main/United%20States%20blizzard%20pattern.png"
                );
                image.setAttribute("width", "100%");
                image.setAttribute("height", "100%");
                image.setAttribute(
                  "clip-path",
                  "url(#clip-" + this.id + ")"
                );

                // Append the image to the SVG
                svgElement.appendChild(image);

                // Remove mouseover and mouseout event listeners
                this.removeEventListener("mouseover", mouseoverHandler);
                this.removeEventListener("mouseout", mouseoutHandler);
              }

              // Increment the click counter
              clickCounter++;
            });
          });
        } else {
          console.log("Error loading SVG");
        }
      };
      xhr.send();

      // Fetch the CSV data from the provided URL
      fetch('"https://raw.githubusercontent.com/Ares-theFox/Risk-Dynamic-Disconnection-Maps/main/Risk%20Connection%20Data%20CSV.csv')
        .then((response) => response.text())
        .then((csvString) => {
          // Parse the CSV data using Papa Parse
          const data = Papa.parse(csvString, { header: true }).data;

          // Create a table element
          const table = document.createElement('table');

          // Create a table row for the headers
          const headerRow = document.createElement('tr');
          Object.keys(data[0]).forEach(key => {
            const th = document.createElement('th');
            th.textContent = key;
            headerRow.appendChild(th);
          });
          table.appendChild(headerRow);

          // Create a table row for each data entry
          data.forEach(entry => {
            const tr = document.createElement('tr');
            Object.values(entry).forEach(value => {
              const td = document.createElement('td');
              td.textContent = value;
              tr.appendChild(td);
            });
            table.appendChild(tr);
          });

          // Append the table to the body of the HTML document
          document.body.appendChild(table);
        });
    </script>
  </body>
</html>
