<!DOCTYPE html>
<html>
  <head>
    <title>Jules Verne's Mysterious Island</title>
    <style>
      #map,
      #range {
        position: absolute;
      }
      #range {
        z-index: 1;
      }
      header {
        font-size: 35px;
        font-weight: bold;
      }
      header img {
        vertical-align: bottom;
      }
    </style>
  </head>
  <body>
    <header>
	Jules Verne Dynamic Disconnection Map 
	<img src="" />
    </header>
<div>
  <button id="button2" onclick="button_AddBlizzards()">Add Blizzards</button>
  <button id="button3" onclick="button_AddPortals()">Add Portals</button>
  <button id="resetButton">Reset Map</button>
</div>
<script>
  document.getElementById("resetButton").addEventListener("click", function () {
    location.reload();
  });
</script>
<script>
var images = [
  "https://raw.githubusercontent.com/Ares-theFox/Risk-Dynamic-Disconnection-Maps/main/ready_fox1.PNG",
  "https://raw.githubusercontent.com/Ares-theFox/Risk-Dynamic-Disconnection-Maps/main/ready_fox2.png",
  "https://raw.githubusercontent.com/Ares-theFox/Risk-Dynamic-Disconnection-Maps/main/ready_fox3.png",
  "https://raw.githubusercontent.com/Ares-theFox/Risk-Dynamic-Disconnection-Maps/main/ready_fox4.png",
  "https://raw.githubusercontent.com/Ares-theFox/Risk-Dynamic-Disconnection-Maps/main/ready_fox5.png",
  "https://raw.githubusercontent.com/Ares-theFox/Risk-Dynamic-Disconnection-Maps/main/ready_fox6.png",
  "https://raw.githubusercontent.com/Ares-theFox/Risk-Dynamic-Disconnection-Maps/main/ready_fox7.png",
  "https://raw.githubusercontent.com/Ares-theFox/Risk-Dynamic-Disconnection-Maps/main/ready_fox8.png",
  "https://raw.githubusercontent.com/Ares-theFox/Risk-Dynamic-Disconnection-Maps/main/ready_fox9.png",
  "https://raw.githubusercontent.com/Ares-theFox/Risk-Dynamic-Disconnection-Maps/main/ready_fox10.png",
  "https://raw.githubusercontent.com/Ares-theFox/Risk-Dynamic-Disconnection-Maps/main/ready_fox11.png",
  "https://raw.githubusercontent.com/Ares-theFox/Risk-Dynamic-Disconnection-Maps/main/ready_fox12.png",
];

window.onload = function() {
  var img = document.querySelector("header img");
  var randomIndex = Math.floor(Math.random() * images.length);
  img.src = images[randomIndex];
};
</script>
	<style>
	/* Add some basic styles to the button */
	button {
	  font-size: 16px;
	  padding: 8px 16px;
	  border: none;
	  cursor: pointer;
	}
		
	#button2 {
	  background-color: white;
	  color: black;
	}

	#button2:hover {
	  background-color: grey;
	}

	#button2:disabled:hover {
	  background-color: white;
	}

	#button3 {
	  background-color: aqua;
	  color: black;
	}

	#button3:hover {
	  background-color: navy;
	  color: white;
	}

	#button3:disabled:hover {
	  background-color: aqua;
	}

	#resetButton {
	background-color: grey;
	color: white;
	}

	#resetButton:hover {
	background-color: black;
	color: white;
	}
	</style>
	  
    <img
      id="map"
      src="https://raw.githubusercontent.com/Ares-theFox/Risk-Dynamic-Disconnection-Maps/main/Jules%20Verne.PNG"
      alt="Jules Verne"
    />
    <div id="range"></div>
	  
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5"></script>
	  
<script>
// Define global variables
	// Define map-specific items
	var colorLegend = "Jules%20Verne%20"
	var DirectConnections = "https://raw.githubusercontent.com/Ares-theFox/Risk-Dynamic-Disconnection-Maps/main/Jules%20Verne%20CSV.csv"
	var IndirectConnections = "https://raw.githubusercontent.com/Ares-theFox/Risk-Dynamic-Disconnection-Maps/main/Jules%20Verne%20Indirect%20Connection%20Locations%20CSV.csv"
	var SVG = "https://raw.githubusercontent.com/Ares-theFox/Risk-Dynamic-Disconnection-Maps/main/Jules%20Verne%20Paths.svg"
	var BlizzardPattern = "https://raw.githubusercontent.com/Ares-theFox/Risk-Dynamic-Disconnection-Maps/main/Jules%20Verne%20blizzard%20pattern.png"
	// Remember to change the img src and the alt title!!!!!!!!
	var blizzardClickCounter = 0
	var blizzardClickCounterMax = 3
	var portalClickCounter = 0
	var portalClickCounterMax = 5
	
	let blizzardArray = []
	let portalArray = []
	let clickedPathsBlizzardsPortals = []
	
	// Define connections tableData
	let tableData;
	let tableDataClone;
	Papa.parse(
	  DirectConnections,
	  {
	    download: true,
	    header: true,
	    complete: function (results) {
	      // Assign parsed data to tableData
	      tableData = results.data;
	      // Remove zero-width space character from tableData
	      for (let i = 0; i < tableData.length; i++) {
		for (let key in tableData[i]) {
		  if (tableData[i].hasOwnProperty(key)) {
		    tableData[i][key] = tableData[i][key].replace(/\u200B/g, "");
		  }
		}
	      }
	      // Create a deep copy of tableData
	      tableDataClone = JSON.parse(JSON.stringify(tableData));
	      console.log(tableData);
	      console.log(tableDataClone);
	    },
	  }
	);

	// Define color dictionaries 
	const colorDictionary = {
	  1: "#eb3337",
	  2: "#fd8238",
	  3: "#fdf12c",
	  4: "#2ed14f",
	  5: "#2ca9f1",
	  6: "#4a51cc",
	  7: "#b948ba",
	  8: "#8b2c32",
	  9: "#5f5f5f",
	 10: "#377a46",
	 11: "#460055",
	 12: "#161616"
	};
	const colorDarktionary = {
	 1: "#761a1c",
	 2: "#7f411c",
	 3: "#7f7916",
	 4: "#176928",
	 5: "#165579",
	 6: "#252966",
	 7: "#5d245d",
	 8: "#461619",
	 9: "#303030",
	10: "#1c3d23",
	11: "#23002b",
	12: "#000000"
	};
	
	// Define csvData as a global variable
	var csvData;

	Papa.parse(
	  IndirectConnections,
	  {
	    download: true,
	    header: true,
	    complete: function (results) {
	      // Assign the parsed data to the global csvData variable
	      csvData = results.data;
	    }
	  }
	);
	
// End of global variables
</script>

<script>
  // Load SVG
  let paths;
  let svgElement;
  var xhr = new XMLHttpRequest();
  xhr.open(
    "GET",
    SVG
  );
  xhr.onload = function () {
    if (xhr.status === 200) {
      var svg = xhr.responseText;
      var rangeElement = document.getElementById("range");
      rangeElement.innerHTML = svg;
      svgElement = rangeElement.querySelector("svg");
      paths = svgElement.querySelectorAll("path");
      paths.forEach(function (path) {
        path.setAttribute("fill", "transparent");
        path.setAttribute("stroke-opacity", "0");
      });
    generateMap();
    }
  };
  xhr.send();
</script>

<script>
// Generate the map
function generateMap() {
  updateButtonText();
  // Reset tableData to its original values
  tableData = JSON.parse(JSON.stringify(tableDataClone));
  // Remove everything contained in the blizzard array
	// Find rows in table data where column A matches values in blizzardArray
	const rows = tableData.filter((row) => blizzardArray.includes(row["A"]));

	// Remove everything in column B for those rows
	rows.forEach((row) => {
	  row["B"] = "";
	});

	// Remove all instances of values in blizzardArray from column B
	tableData.forEach((row) => {
	  if (row["B"]) {
	    // Split the value in column B into an array of values
	    let values = row["B"].split(",");
	    // Filter out any values that are included in the blizzardArray
	    values = values.filter((value) => !blizzardArray.includes(value));
	    // Join the remaining values back into a string and update the value in column B
	    row["B"] = values.join(",");
	  }
	});
  // Add everything contained in the portal array
	// Iterate over tableData
	tableData.forEach((row) => {
	  // Check if value in column A matches a value in portalArray
	  if (portalArray.includes(row["A"])) {
	    // Add contents of portalArray to column B
	    row["B"] = [...new Set([...(row["B"] ? row["B"].split(",") : []), ...portalArray])].join(",");
	  }
	});
  // Recalculate columns L through P for all rows
  tableData.forEach((row) => {
    // Column M: vlookup col B values and add them + current value A and B
    row["M"] = ""; // initialize column M to blank
    if (row["B"] && row["B"].trim() !== "") {
      // check if column B is not empty or undefined
      const searchValues = row["B"].split(",");
      let searchResults = [];
      for (const searchValue of searchValues) {
        const trimmedSearchValue = searchValue.trim().replace(/\u200B/g, "");
        for (let i = 0; i < tableData.length; i++) {
          if (tableData[i]["A"] === trimmedSearchValue) {
            searchResults.push(tableData[i]["B"]);
            break;
          }
        }
      }
      row["M"] = [row["A"], row["B"], ...searchResults].join(",");
    }

    // Column N: Remove duplicate values from column M
    row["N"] = [...new Set(row["M"].split(","))]
      .filter((value) => value !== row["A"])
      .join(",");
	  
    // Column O: Count how many comma-separated values are in column B
    if (row["B"] && row["B"].trim() !== "") {
      // check if column B is not empty or undefined
      const values = row["B"].split(",");
      row["O"] = values.length;
    } else {
      row["O"] = 0;
    }

    // Column P: Count how many comma-separated values are in column N (unless it's empty, then set it to 0)
    if (row["N"] && row["N"].trim() !== "") {
      // check if column N is not empty or undefined
      const values = row["N"].split(",");
      row["P"] = values.length;
    } else {
      row["P"] = 0;
    }
  });

  // Log updated table data to console
  console.log(tableData);

  // Set font size of indirect connections
  var fontSize = 30;

  // Color in the map and add indirect connections
  paths.forEach(function (path) {
    var pathId = path.getAttribute("id");
    for (var i = 0; i < tableData.length; i++) {
      if (tableData[i]["A"] === pathId) {
        // Color in the map
        var value = tableData[i]["O"];
        if (value >= 12) {
          value = 12;
        }
        if (value !== 0) {
          var color = colorDictionary[value];
          var border_color = colorDarktionary[value];
          path.style.setProperty("fill", color, "important");
          path.setAttribute("stroke-opacity", "100");
          path.style.setProperty("stroke", border_color, "important");
          path.style.setProperty("stroke-width", "2", "important");
        }

        // Add text to the specified location from CSV data
        value = tableData[i]["P"];
        if (value !== 0) {
          // Find matching row in CSV data
          var csvRow = csvData.find(function (row) {
            return row["Range"] === pathId;
          });

          // Get coordinates from CSV data
          var x = csvRow["Pixel Pair 1"];
          var y = csvRow["Pixel Pair 2"];

          var text = document.createElementNS(
            "http://www.w3.org/2000/svg",
            "text"
          );
          text.setAttribute("x", x);
          text.setAttribute("y", y);
          text.setAttribute("text-anchor", "middle");
          text.setAttribute("alignment-baseline", "middle");
          text.setAttribute("font-size", fontSize);
          text.setAttribute("font-weight", "bold");
	  if (tableData[i]["O"] >= 11) {
	    text.setAttribute("fill", "white");
	  } else {
	    text.setAttribute("fill", "black");
	  }
          text.textContent = value;

          // Adjust x and y coordinates to position midpoint of text at specified coordinates
          var bbox = text.getBBox();
          text.setAttribute("x", x - bbox.width / 2);
          text.setAttribute("y", y - bbox.height / 2);

          svgElement.appendChild(text);
        }
        break;
      }
    }
  });
	// Find the maximum value in column O
	var maxO = Math.max(...tableData.map((row) => row["O"]));

	// Ensure that maxO is never greater than 12
	if (maxO > 12) {
	  maxO = 12;
	}
	// Get the base image element & define base URL
	var baseImage = document.getElementById("map");
	var baseURL = "https://raw.githubusercontent.com/Ares-theFox/Risk-Dynamic-Disconnection-Maps/main/";

	// Decide which image to display based on the maximum value in column O
	baseImage.src = baseURL + colorLegend + maxO + ".png";
}
</script>
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
</script>
</body>
</html>
	  

	  
	  
	  
	  
	  
	  
	  
	  
	  
	  
	  
	  
	  
	  
	  
	  
	  
	  
	  
	  
	  
